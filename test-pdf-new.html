<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Header Fix Test - New Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      button {
        background-color: #2563eb;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin: 10px;
      }
      button:hover {
        background-color: #1d4ed8;
      }
      .status {
        background-color: #e7f3ff;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #2563eb;
      }
      .issue {
        background-color: #fff5f5;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #ef4444;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìÑ PDF Header Visibility Test</h1>

      <div class="status">
        <h3>‚úÖ Applied Fixes:</h3>
        <ul>
          <li>
            <strong>Text Color:</strong> Changed to BLACK (0,0,0) for maximum
            visibility
          </li>
          <li>
            <strong>Background:</strong> Light gray (240,240,240) instead of
            blue
          </li>
          <li><strong>Font:</strong> Bold, size 9 for better readability</li>
          <li><strong>Borders:</strong> Uniform blue borders throughout</li>
        </ul>
      </div>

      <div class="issue">
        <h3>üîç Previous Issue:</h3>
        <p>
          Headers had white text on potentially invisible blue background,
          making text completely invisible in PDF viewers.
        </p>
      </div>

      <button onclick="generateFixedPDF()">üîß Generate Fixed PDF</button>
      <button onclick="generateOldPDF()">üêõ Generate Old PDF (broken)</button>

      <div id="result" style="margin-top: 20px; font-weight: bold"></div>
    </div>

    <script>
      function addCustomTableHeader(doc, startY) {
        const headers = [
          "#",
          "ITEM DESCRIPTION",
          "QTY",
          "UNIT",
          "UNIT PRICE (KSH)",
          "VAT %",
          "TOTAL (KSH)",
        ];
        const columnWidths = [12, 65, 15, 18, 25, 15, 30];
        const columnPositions = [20]; // Starting position

        // Calculate column positions
        for (let i = 1; i < columnWidths.length; i++) {
          columnPositions.push(columnPositions[i - 1] + columnWidths[i - 1]);
        }

        // Light gray background for better text visibility
        doc.setFillColor(240, 240, 240); // Light gray background
        doc.rect(20, startY, 180, 18, "F");

        // Uniform blue border
        doc.setDrawColor(37, 99, 235); // Blue border
        doc.setLineWidth(1.5);
        doc.rect(20, startY, 180, 18);

        // Column separators with blue lines
        doc.setDrawColor(37, 99, 235);
        doc.setLineWidth(1);
        for (let i = 1; i < columnPositions.length; i++) {
          const x = columnPositions[i];
          doc.line(x, startY, x, startY + 18);
        }

        // Header text - BOLD AND BLACK for visibility
        doc.setTextColor(0, 0, 0); // BLACK TEXT
        doc.setFontSize(9);
        doc.setFont("helvetica", "bold");

        headers.forEach((header, index) => {
          const x = columnPositions[index] + columnWidths[index] / 2;
          doc.text(header, x, startY + 11, { align: "center" });
        });

        // Reset colors
        doc.setTextColor(0, 0, 0);
        doc.setDrawColor(0, 0, 0);
      }

      function generateFixedPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Sample data
        const tableData = [
          [
            1,
            "Medical Syringes 10ml",
            100,
            "Piece",
            "25.00",
            "16%",
            "2,900.00",
          ],
          [2, "Surgical Gloves Size M", 50, "Box", "150.00", "16%", "8,700.00"],
          [3, "Digital Thermometer", 25, "Piece", "320.00", "16%", "9,280.00"],
        ];

        // Company header
        doc.setFontSize(18);
        doc.setFont("helvetica", "bold");
        doc.text("MEDPLUS AFRICA LIMITED", 105, 25, { align: "center" });

        doc.setFontSize(14);
        doc.text("INVOICE - FIXED HEADERS TEST", 105, 40, { align: "center" });

        doc.setFontSize(10);
        doc.text(
          "Headers should now be visible with BLACK text on light gray background",
          105,
          55,
          { align: "center" },
        );

        // Use new custom header function
        addCustomTableHeader(doc, 75);

        // Table without header
        doc.autoTable({
          startY: 95,
          body: tableData,
          theme: "grid",
          styles: {
            fontSize: 9,
            cellPadding: 4,
            lineColor: [180, 180, 180],
            lineWidth: 0.3,
            textColor: [40, 40, 40],
          },
          columnStyles: {
            0: { halign: "center", cellWidth: 12 },
            1: { halign: "left", cellWidth: 65 },
            2: { halign: "center", cellWidth: 15 },
            3: { halign: "center", cellWidth: 18 },
            4: { halign: "right", cellWidth: 25 },
            5: { halign: "center", cellWidth: 15 },
            6: { halign: "right", cellWidth: 30 },
          },
        });

        // Save the PDF
        doc.save("fixed-headers-test.pdf");
        document.getElementById("result").innerHTML =
          "‚úÖ Fixed PDF generated! Headers should be clearly visible.";
      }

      function generateOldPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Sample data
        const tableData = [
          [
            1,
            "Medical Syringes 10ml",
            100,
            "Piece",
            "25.00",
            "16%",
            "2,900.00",
          ],
          [2, "Surgical Gloves Size M", 50, "Box", "150.00", "16%", "8,700.00"],
          [3, "Digital Thermometer", 25, "Piece", "320.00", "16%", "9,280.00"],
        ];

        // Company header
        doc.setFontSize(18);
        doc.setFont("helvetica", "bold");
        doc.text("MEDPLUS AFRICA LIMITED", 105, 25, { align: "center" });

        doc.setFontSize(14);
        doc.text("INVOICE - OLD BROKEN HEADERS", 105, 40, { align: "center" });

        doc.setFontSize(10);
        doc.text(
          "Headers will be invisible due to white text on blue background",
          105,
          55,
          { align: "center" },
        );

        // Old broken method with blue background and white text
        doc.setFillColor(37, 99, 235); // Blue background
        doc.rect(20, 75, 180, 18, "F");
        doc.setTextColor(255, 255, 255); // WHITE TEXT (invisible!)
        doc.setFontSize(8);
        doc.setFont("helvetica", "bold");
        doc.text("#", 26, 86, { align: "center" });
        doc.text("ITEM DESCRIPTION", 87, 86, { align: "center" });
        doc.text("QTY", 142, 86, { align: "center" });
        // ... other headers would be invisible too

        // Reset
        doc.setTextColor(0, 0, 0);

        // Table
        doc.autoTable({
          startY: 95,
          body: tableData,
          theme: "grid",
          styles: {
            fontSize: 9,
            cellPadding: 4,
          },
          columnStyles: {
            0: { halign: "center", cellWidth: 12 },
            1: { halign: "left", cellWidth: 65 },
            2: { halign: "center", cellWidth: 15 },
            3: { halign: "center", cellWidth: 18 },
            4: { halign: "right", cellWidth: 25 },
            5: { halign: "center", cellWidth: 15 },
            6: { halign: "right", cellWidth: 30 },
          },
        });

        // Save the PDF
        doc.save("broken-headers-test.pdf");
        document.getElementById("result").innerHTML =
          "‚ùå Old PDF generated. Headers will be invisible (white text issue).";
      }
    </script>
  </body>
</html>
